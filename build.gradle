plugins {
  id "base"
  id "java"
  id "com.github.node-gradle.node" version "2.2.4"
  id "com.bmuschko.docker-remote-api" version "6.6.1"
}
import com.bmuschko.gradle.docker.tasks.image.Dockerfile
import com.bmuschko.gradle.docker.tasks.image.DockerBuildImage

node {
  version = "10.9.0"
  npmVersion = "6.4.1"
  download = true
}

task cleanAll (type:Delete) {
  delete "${projectDir}/node_modules"
  delete "dist"
}

task dockerized(type: DockerBuildImage) {
  inputDir = file("./")
  images.add("nexus.epsoftinc.in/cloud-ui:0.0.1-DM1")
}

task buildAll {
  dependsOn "clean"
  dependsOn "build"
  dependsOn "dockerized"
  tasks.findByName("build").mustRunAfter "clean"
  tasks.findByName("dockerized").mustRunAfter "build"
}

jar.dependsOn "npm_run_build"
clean.dependsOn "cleanAll"

